<!DOCTYPE html><html><head><meta charset="utf-8"><title>Using NGINX As Reverse Proxy | Ibhi's blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="nginx,reverse-proxy"><meta name="description" content="Use CaseWhen hosting our web applications, we often have one public IP address (i.e., an IP address visible to the outside world) using which we want to host multiple web apps. For example, one may wa"><meta name="keywords" content="nginx,reverse-proxy"><meta property="og:type" content="article"><meta property="og:title" content="Using NGINX As Reverse Proxy"><meta property="og:url" content="http://blog.noobish.in/2018/01/13/Using-NGINX-As-Reverse-Proxy/index.html"><meta property="og:site_name" content="Ibhi's blog"><meta property="og:description" content="Use CaseWhen hosting our web applications, we often have one public IP address (i.e., an IP address visible to the outside world) using which we want to host multiple web apps. For example, one may wa"><meta property="og:locale" content="en"><meta property="og:image" content="http://blog.noobish.in/2018/01/13/Using-NGINX-As-Reverse-Proxy/nginxhero.jpg"><meta property="og:updated_time" content="2018-01-13T15:58:45.852Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Using NGINX As Reverse Proxy"><meta name="twitter:description" content="Use CaseWhen hosting our web applications, we often have one public IP address (i.e., an IP address visible to the outside world) using which we want to host multiple web apps. For example, one may wa"><meta name="twitter:image" content="http://blog.noobish.in/2018/01/13/Using-NGINX-As-Reverse-Proxy/nginxhero.jpg"><link rel="alternate" href="/" title="Ibhi's blog" type="application/atom+xml"><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/libs/titillium-web/styles.css"><link rel="stylesheet" href="/libs/source-code-pro/styles.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css"><link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css"><script type="text/javascript">!function(e,a,t,n,c,g,o){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,g=a.createElement("script"),o=a.getElementsByTagName("script")[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(g,o)}(window,document),ga("create","UA-47901901-2","auto"),ga("send","pageview")</script></head><body><div id="wrap"><header id="header"><div id="header-outer" class="outer"><div class="container"><div class="container-inner"><div id="header-title"><h1 class="logo-wrap"><a href="/" class="logo"></a></h1><h2 class="subtitle-wrap"><p class="subtitle">Limited only by imagination</p></h2></div><div id="header-inner" class="nav-container"><a id="main-nav-toggle" class="nav-icon fa fa-bars"></a><div class="nav-container-inner"><ul id="main-nav"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/">Home</a></li><ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Cloud/">Cloud</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Web/">Web</a></li></ul><li class="main-nav-list-item"><a class="main-nav-list-link" href="/About/index.html">About</a></li></ul><nav id="sub-nav"><div id="search-form-wrap"><form class="search-form"><input type="text" class="ins-search-input search-form-input" placeholder="Search"> <button type="submit" class="search-form-submit"></button></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="Type something..."> <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script></div></nav></div></div></div></div></div></header><div class="container"><div class="main-body container-inner"><div class="main-body-inner"><section id="main"><div class="main-body-header"><h1 class="header"><a class="page-title-link" href="/categories/Web/">Web</a></h1></div><div class="main-body-content"><article id="post-Using-NGINX-As-Reverse-Proxy" class="article article-single article-type-post" itemscope="" itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Using NGINX As Reverse Proxy</h1></header><div class="article-meta"><div class="article-date"><a href="/2018/01/13/Using-NGINX-As-Reverse-Proxy/" class="article-date"><time datetime="2018-01-13T12:49:49.000Z" itemprop="datePublished">2018-01-13</time></a></div><div class="article-tag"><i class="fa fa-tag"></i> <a class="tag-link" href="/tags/nginx/">nginx</a>, <a class="tag-link" href="/tags/reverse-proxy/">reverse-proxy</a></div></div><div class="article-entry" itemprop="articleBody"><img src="/2018/01/13/Using-NGINX-As-Reverse-Proxy/nginxhero.jpg"><h3 id="Use-Case"><a href="#Use-Case" class="headerlink" title="Use Case"></a>Use Case</h3><p>When hosting our web applications, we often have one public IP address (i.e., an IP address visible to the outside world) using which we want to host multiple web apps. For example, one may wants to host three different web apps respectively for example1.com, example2.com, and example1.com/images on the same machine using a single IP address.</p><h3 id="How-can-we-do-that"><a href="#How-can-we-do-that" class="headerlink" title="How can we do that?"></a>How can we do that?</h3><p>Well, the good news is Internet browsers send the domain name inside HTTP requests and all we need to do is to parse the requested domain name and URL and then route the HTTP request to the actual web server. This can be easily by done with nginx by configuring it as a reverse proxy for different applications.</p><h3 id="Intall-nginx-Ubuntu"><a href="#Intall-nginx-Ubuntu" class="headerlink" title="Intall nginx (Ubuntu)"></a>Intall nginx (Ubuntu)</h3><p>Install nginx using apt-get:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install nginx -y</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><p>nginx default config file is located at <code>/etc/nginx/sites-enabled/default</code>, this is the file we need to modify.</p>
<p>Let say we want to configure nginx to route requests from /blog, and /mail, respectively onto localhost:3000 and localhost:3001.</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">                  +--- host/blog --------> node.js on localhost:3000</span><br><span class="line">                  |</span><br><span class="line">users --> nginx --|</span><br><span class="line">                  |</span><br><span class="line">                  +--- host/mail ---> node.js on localhost:3001</span><br></pre></td></tr></tbody></table></figure>
<p>Lets modify the default nginx configuration (<code>/etc/nginx/sites-enabled/default</code>) to achieve the above use case as shown below</p>
<figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / {</span><br><span class="line">        <span class="comment"># First attempt to serve request as file, then</span></span><br><span class="line">        <span class="comment"># as directory, then fall back to displaying a 404.</span></span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> /blog {</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/blog(.*)</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:3000;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> /mail {</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/mail(.*)</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:3001;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>proxy_pass</code> simply tells <code>nginx</code> to forward requests to /blog to the server listening on <a href="http://127.0.0.1:3000" target="_blank" rel="noopener">http://127.0.0.1:3000</a>.<br><code>rewrite ^/blog(.*) /$1 break;</code> regular expression tells <code>nginx</code> to capture anything after <code>/blog</code> and pass it to the proxy pass, this is needed because our nodejs web servers are listening on <code>/</code> not on <code>/blog</code>. <code>break</code> tells <code>nginx</code> to stop further lookup.</p>
<h3 id="Reload-NGINX"><a href="#Reload-NGINX" class="headerlink" title="Reload NGINX"></a>Reload NGINX</h3><p>After making the above configuration changes, we need to reload <code>nginx</code> (no need to restart)<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx reload</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Once it is sucessfully reloaded, we can test the above configuration by making requests to the above routes in our browser, like</p>
<p><code>http://YOUR_PUBLIC_IP/blog</code> and <code>http://YOUR_PUBLIC_IP/mail</code> should serve the response from nodejs applications running on port 3000 and 3001 respectively. Voila!!</p>
<p>Here is a sample expressjs app, if you want to play with <a href="https://gist.github.com/ibhi/0ab0342ae140612078fdd3f7e1cdf6f1" target="_blank" rel="noopener">https://gist.github.com/ibhi/0ab0342ae140612078fdd3f7e1cdf6f1</a></p>
<p>Please let me know your feedback or comments in the comments section below.</p>
        </div>
        <footer class="article-footer">
            <a data-url="http://blog.noobish.in/2018/01/13/Using-NGINX-As-Reverse-Proxy/" data-id="cjd79t1tx0007fwwr9rmxycjt" class="article-share-link"><i class="fa fa-share"></i>Share</a><script>!function(t){t("body").on("click",function(){t(".article-share-box.on").removeClass("on")}).on("click",".article-share-link",function(e){e.stopPropagation();var a,o=t(this),r=o.attr("data-url"),i=encodeURIComponent(r),s="article-share-box-"+o.attr("data-id"),l=o.offset();if(t("#"+s).length){if((a=t("#"+s)).hasClass("on"))return void a.removeClass("on")}else{var n=['<div id="'+s+'" class="article-share-box">','<input class="article-share-input" value="'+r+'">','<div class="article-share-links">','<a href="https://twitter.com/intent/tweet?url='+i+'" class="article-share-twitter" target="_blank" title="Twitter"></a>','<a href="https://www.facebook.com/sharer.php?u='+i+'" class="article-share-facebook" target="_blank" title="Facebook"></a>','<a href="http://pinterest.com/pin/create/button/?url='+i+'" class="article-share-pinterest" target="_blank" title="Pinterest"></a>','<a href="https://plus.google.com/share?url='+i+'" class="article-share-google" target="_blank" title="Google+"></a>',"</div>","</div>"].join("");a=t(n),t("body").append(a)}t(".article-share-box.on").hide(),a.css({top:l.top+25,left:l.left}).addClass("on")}).on("click",".article-share-box",function(t){t.stopPropagation()}).on("click",".article-share-box-input",function(){t(this).select()}).on("click",".article-share-box-link",function(t){t.preventDefault(),t.stopPropagation(),window.open(this.href,"article-share-box-window-"+Date.now(),"width=500,height=450")})}(jQuery)</script>
        </footer>
    </div>
</article>
<section id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section>
                        </div>
                    </section>
                    <aside id="sidebar"><a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a><div class="sidebar-top"><p>follow:</p><ul class="social-links"><li><a class="social-tooltip" title="twitter" href="/" target="_blank"><i class="icon fa fa-twitter"></i></a></li><li><a class="social-tooltip" title="facebook" href="/" target="_blank"><i class="icon fa fa-facebook"></i></a></li><li><a class="social-tooltip" title="google-plus" href="/" target="_blank"><i class="icon fa fa-google-plus"></i></a></li><li><a class="social-tooltip" title="github" href="https://github.com/ibhi" target="_blank"><i class="icon fa fa-github"></i></a></li><li><a class="social-tooltip" title="weibo" href="/" target="_blank"><i class="icon fa fa-weibo"></i></a></li><li><a class="social-tooltip" title="rss" href="/" target="_blank"><i class="icon fa fa-rss"></i></a></li></ul></div><nav id="article-nav"><a href="/2018/01/15/AWS-Helpful-Links/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">newer</strong><p class="article-nav-title">AWS Helpful Links</p><i class="icon fa fa-chevron-right" id="icon-chevron-right"></i> </a><a href="/2018/01/13/Starting-and-stopping-EC2-instances-on-schedule/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">older</strong><p class="article-nav-title">Stop and Start Amazon EC2 instances at regular intervals using AWS Lambda</p><i class="icon fa fa-chevron-left" id="icon-chevron-left"></i></a></nav><div class="widgets-container"><div class="widget-wrap"><h3 class="widget-title">recents</h3><div class="widget"><ul id="recent-post"><li><div class="item-thumbnail"><a href="/2018/01/15/AWS-Helpful-Links/" class="thumbnail"><span class="thumbnail-image thumbnail-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Cloud/">Cloud</a></p><p class="item-title"><a href="/2018/01/15/AWS-Helpful-Links/" class="title">AWS Helpful Links</a></p><p class="item-date"><time datetime="2018-01-15T06:26:31.000Z" itemprop="datePublished">2018-01-15</time></p></div></li><li><div class="item-thumbnail"><a href="/2018/01/13/Using-NGINX-As-Reverse-Proxy/" class="thumbnail"><span style="background-image:url(/2018/01/13/Using-NGINX-As-Reverse-Proxy/nginxhero.jpg)" alt="Using NGINX As Reverse Proxy" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Web/">Web</a></p><p class="item-title"><a href="/2018/01/13/Using-NGINX-As-Reverse-Proxy/" class="title">Using NGINX As Reverse Proxy</a></p><p class="item-date"><time datetime="2018-01-13T12:49:49.000Z" itemprop="datePublished">2018-01-13</time></p></div></li><li><div class="item-thumbnail"><a href="/2018/01/13/Starting-and-stopping-EC2-instances-on-schedule/" class="thumbnail"><span style="background-image:url(/2018/01/13/Starting-and-stopping-EC2-instances-on-schedule/amazon-ec2.jpg)" alt="Stop and Start Amazon EC2 instances at regular intervals using AWS Lambda" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Cloud/">Cloud</a></p><p class="item-title"><a href="/2018/01/13/Starting-and-stopping-EC2-instances-on-schedule/" class="title">Stop and Start Amazon EC2 instances at regular intervals using AWS Lambda</a></p><p class="item-date"><time datetime="2018-01-13T07:31:54.000Z" itemprop="datePublished">2018-01-13</time></p></div></li><li><div class="item-thumbnail"><a href="/2017/02/04/protractor-tutorial/" class="thumbnail"><span style="background-image:url(/2017/02/04/protractor-tutorial/angular-protractor.png)" alt="Protractor Tutorial" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Web/">Web</a></p><p class="item-title"><a href="/2017/02/04/protractor-tutorial/" class="title">Protractor Tutorial</a></p><p class="item-date"><time datetime="2017-02-04T14:07:18.000Z" itemprop="datePublished">2017-02-04</time></p></div></li><li><div class="item-thumbnail"><a href="/2015/10/07/Hexo-Github-Pages-Your-own-blog-site/" class="thumbnail"><span style="background-image:url(/2015/10/07/Hexo-Github-Pages-Your-own-blog-site/hexo-blog.jpg)" alt="Hexo + Github Pages = Your own blog site" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Web/">Web</a></p><p class="item-title"><a href="/2015/10/07/Hexo-Github-Pages-Your-own-blog-site/" class="title">Hexo + Github Pages = Your own blog site</a></p><p class="item-date"><time datetime="2015-10-07T02:30:08.000Z" itemprop="datePublished">2015-10-07</time></p></div></li></ul></div></div><div class="widget-wrap widget-list"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Cloud/">Cloud</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">3</span></li></ul></div></div><div class="widget-wrap widget-list"><h3 class="widget-title">archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li></ul></div></div><div class="widget-wrap widget-list"><h3 class="widget-title">tags</h3><div class="widget"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/angularjs/">angularjs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws/">aws</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/e2e/">e2e</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ec2/">ec2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda/">lambda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/links/">links</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nat/">nat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nat-gateway/">nat gateway</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/protractor/">protractor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reverse-proxy/">reverse-proxy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/testing/">testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vpc/">vpc</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget-wrap widget-float"><h3 class="widget-title">tag cloud</h3><div class="widget tagcloud"><a href="/tags/angularjs/" style="font-size:10px">angularjs</a> <a href="/tags/aws/" style="font-size:10px">aws</a> <a href="/tags/e2e/" style="font-size:10px">e2e</a> <a href="/tags/ec2/" style="font-size:10px">ec2</a> <a href="/tags/lambda/" style="font-size:10px">lambda</a> <a href="/tags/links/" style="font-size:10px">links</a> <a href="/tags/nat/" style="font-size:10px">nat</a> <a href="/tags/nat-gateway/" style="font-size:10px">nat gateway</a> <a href="/tags/nginx/" style="font-size:10px">nginx</a> <a href="/tags/protractor/" style="font-size:10px">protractor</a> <a href="/tags/reverse-proxy/" style="font-size:10px">reverse-proxy</a> <a href="/tags/testing/" style="font-size:10px">testing</a> <a href="/tags/vpc/" style="font-size:10px">vpc</a></div></div><div class="widget-wrap widget-list"><h3 class="widget-title">links</h3><div class="widget"><ul><li><a href="http://hexo.io">Hexo</a></li></ul></div></div></div></aside>
                </div>
            </div>
        </div>
        <footer id="footer"><div class="container"><div class="container-inner"><a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a><div class="credit"><h1 class="logo-wrap"><a href="/" class="logo"></a></h1><p>© 2018 Ibrahim</p><p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p></div></div></div></footer>
        <script>var disqus_shortname="noobish",disqus_url="http://blog.noobish.in/2018/01/13/Using-NGINX-As-Reverse-Proxy/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script></div><script type="text/javascript" src="/js/bundle.js"></script></body></html>